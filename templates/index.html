<!DOCTYPE html>
<html>
<head>
<title>Indian Stock Dashboard</title>

<style>
body{
font-family:Arial;
background:#020617;
color:white;
text-align:center;
}

h1{color:#22c55e}

button{
padding:12px;
margin:8px;
border:none;
background:#22c55e;
color:white;
font-size:16px;
cursor:pointer;
border-radius:6px;
}

input{
padding:12px;
margin:8px;
width:220px;
border-radius:6px;
border:none;
}

.card{
background:#0f172a;
margin:15px auto;
padding:15px;
width:90%;
border-radius:10px;
box-shadow:0 0 10px #000;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:10px;
border-bottom:1px solid #334155;
}

.green{color:#22c55e;font-weight:bold;}
.red{color:#ef4444;font-weight:bold;}

.loader{
display:none;
margin:20px;
font-size:18px;
color:yellow;
}
</style>
</head>

<body>

<h1>ğŸ“ˆ Indian Stock Market Dashboard</h1>
<h3>Developed by Nivrutti Aware | StepUp Classes</h3>

<!-- SEARCH -->
<h2>ğŸ” Search Stock</h2>
<input id="stockname" placeholder="Enter stock name">
<button onclick="searchStock()">Search</button>

<div class="loader" id="load1">â³ Loading...</div>
<div id="stockresult"></div>

<hr>

<button onclick="loadPrice()">ğŸ“Š Price Shockers</button>
<button onclick="loadIPO()">ğŸš€ IPO</button>
<button onclick="loadNews()">ğŸ“° News</button>

<div class="loader" id="load2">â³ Loading...</div>
<div id="data"></div>

<hr>

<h2>ğŸ’ Subscribe</h2>
<input id="name" placeholder="Name">
<input id="email" placeholder="Email">
<input id="phone" placeholder="Phone">
<input id="plan" placeholder="Plan">
<button onclick="subscribe()">Subscribe</button>

<br><br>
<a href="/admin" target="_blank">
<button>ğŸ” Admin Dashboard</button>
</a>

<script>

function showLoader(id){
document.getElementById(id).style.display="block";
setTimeout(()=>{document.getElementById(id).style.display="none"},4000);
}

function searchStock(){
let s=document.getElementById("stockname").value;
showLoader("load1");

fetch("/search/"+s)
.then(r=>r.json())
.then(d=>{

if(!d || d.error){
document.getElementById("stockresult").innerHTML="<div class='card'>âŒ No Data Found</div>";
return;
}

let html="<div class='card'>";
html+="<h2>ğŸ“Š "+(d.companyName || s)+"</h2>";

/* BASIC INFO */
html+="<table>";
html+="<tr><td>ğŸ¢ Company</td><td>"+(d.companyName||'-')+"</td></tr>";
html+="<tr><td>ğŸ­ Industry</td><td>"+(d.industry||'-')+"</td></tr>";

if(d.currentPrice){
html+="<tr><td>ğŸ’° Current Price</td><td class='green'>â‚¹ "+(d.currentPrice.NSE||'-')+"</td></tr>";
}

html+="</table><br>";

/* ANALYST VIEW */
if(d.analystView){
html+="<h3>ğŸ“ˆ Analyst Rating</h3>";
html+="<table><tr><th>Rating</th><th>Analysts</th></tr>";

d.analystView.forEach(a=>{
html+=`<tr>
<td>${a.ratingName||'-'}</td>
<td>${a.numberOfAnalystsLatest||'-'}</td>
</tr>`;
});

html+="</table><br>";
}

/* FINANCIALS */
if(d.financials){
html+="<h3>ğŸ’¼ Financials</h3>";
html+="<table><tr><th>Year</th><th>Revenue</th><th>Profit</th></tr>";

d.financials.slice(0,5).forEach(f=>{
html+=`<tr>
<td>${f.year||'-'}</td>
<td>${f.revenue||'-'}</td>
<td>${f.profit||'-'}</td>
</tr>`;
});

html+="</table>";
}

html+="</div>";

document.getElementById("stockresult").innerHTML=html;
});
}


function loadPrice(){
showLoader("load2");

fetch("/price")
.then(r=>r.json())
.then(d=>{
let html="<div class='card'><h3>ğŸ”¥ Price Shockers</h3><table>";
html+="<tr><th>Name</th><th>Price</th><th>%Change</th><th>Trend</th></tr>";

let arr=d.BSE_PriceShocker || [];

arr.forEach(x=>{
let color=x.percentChange>0?"green":"red";
let arrow=x.percentChange>0?"â–²":"â–¼";

html+=`<tr>
<td>${x.displayName}</td>
<td>${x.price}</td>
<td class="${color}">${x.percentChange}%</td>
<td class="${color}">${arrow}</td>
</tr>`;
});

html+="</table></div>";
document.getElementById("data").innerHTML=html;
});
}

function loadIPO(){
showLoader("load2");

fetch("/ipo")
.then(r=>r.json())
.then(d=>{
let html="<div class='card'><h3>ğŸš€ IPO List</h3><table>";
html+="<tr><th>Name</th><th>Price</th><th>Status</th></tr>";

(d||[]).forEach(x=>{
html+=`<tr>
<td>${x.name||'-'}</td>
<td>${x.price||'-'}</td>
<td class="green">${x.status||'-'}</td>
</tr>`;
});

html+="</table></div>";
document.getElementById("data").innerHTML=html;
});
}

function loadNews(){
showLoader("load2");

fetch("/news")
.then(r=>r.json())
.then(d=>{
let html="<div class='card'><h3>ğŸ“° Market News</h3>";

(d.data||[]).forEach(x=>{
html+=`<p>ğŸ”¹ ${x.title}</p>`;
});

html+="</div>";
document.getElementById("data").innerHTML=html;
});
}

function subscribe(){
fetch("/subscribe",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:document.getElementById("name").value,
email:document.getElementById("email").value,
phone:document.getElementById("phone").value,
plan:document.getElementById("plan").value
})
})
.then(r=>r.json())
.then(d=>alert(d.msg));
}

</script>
</body>
</html>
